{"version":3,"file":"ssr-qe3qnNOs.js","sources":["../../../src/state/effect.ts","../../../src/util.ts","../../../src/render/specialComponent.ts","../../../src/render/patch.ts","../../../src/render/handleChildren.ts","../../../src/const.ts","../../../src/render/handleProps.ts","../../../src/render/render.ts","../../../src/render/ssr.ts"],"sourcesContent":["export type EffectFn = () => void;\n\nexport let activeEffect: EffectFn | null = null;\n\nexport function effect(fn: EffectFn): void {\n  effectify(fn);\n}\n\nexport function effectify(fn: EffectFn): EffectFn {\n  const run = () => {\n    activeEffect = run;\n    fn();\n    activeEffect = null;\n  };\n  run();\n  return run;\n}\n\nconst depMap: WeakMap<object, Map<PropertyKey, Set<EffectFn>>> = new WeakMap();\n\nexport function track(target: object, key: PropertyKey): void {\n  if (!activeEffect) return;\n\n  let deps = depMap.get(target);\n  if (!deps) {\n    deps = new Map<PropertyKey, Set<EffectFn>>();\n    depMap.set(target, deps);\n  }\n\n  let dep = deps.get(key);\n  if (!dep) {\n    dep = new Set<EffectFn>();\n    deps.set(key, dep);\n  }\n\n  dep.add(activeEffect);\n}\n\nexport function trigger(target: object, key: PropertyKey): void {\n  const deps = depMap.get(target);\n  if (!deps) return;\n\n  const dep = deps.get(key);\n  if (!dep) return;\n\n  for (const effect of dep) {\n    effect();\n  }\n}\n","export const normalizeDom = <T = any>(children: T | T[]) => {\n  return Array.isArray(children) ? children : [children];\n};\n\nexport const isNil = (value: unknown): value is null | undefined | false => {\n  return value === undefined || value === null || value === false;\n};\n\nexport function getNode(\n  node: JSX.Element | (() => JSX.Element)\n): Node | undefined {\n  if (typeof node === \"string\" || typeof node === \"number\") {\n    return document.createTextNode(String(node)) as Node;\n  }\n\n  if (node instanceof HTMLElement || node instanceof Text) {\n    return node as Node;\n  }\n\n  if (isNil(node)) {\n    return undefined;\n  }\n\n  if (typeof node !== \"function\") {\n    return node as Node;\n  }\n\n  return getNode((node as () => Node)());\n}\n","// Mount special components need to be mounted manually like <For>\nexport const mountSpecialComponent = (_$node: Node) => {\n  interface RefNode extends Text {\n    mount?: (node: Node) => void;\n  }\n  const $node = _$node as RefNode;\n  $node.mount?.($node);\n  // delete $node.mount;\n};\n\n// Unmount special components need to be mounted manually like <For>\nexport const unmountSpecialComponent = (_$node: Node) => {\n  interface RefNode extends Text {\n    unmount?: (node: Node) => void;\n  }\n  const $node = _$node as RefNode;\n  $node.unmount?.($node);\n  // delete $node.unmount;\n};\n","import { getNode, isNil } from \"../util\";\nimport {\n  mountSpecialComponent,\n  unmountSpecialComponent,\n} from \"./specialComponent\";\n\nexport function patch(\n  $parent: Node,\n  $oldNodes: (JSX.Element | (() => JSX.Element))[],\n  $newNodes: any[],\n  $anchor: Node | null = null\n) {\n  const maxLength = Math.max($oldNodes.length, $newNodes.length);\n\n  for (let i = 0; i < maxLength; i++) {\n    const $oldNode = getNode($oldNodes[i]);\n    const $newNode = getNode($newNodes[i]);\n\n    // Remove old node if new one doesn't exist\n    if (!isNil($oldNode) && isNil($newNode) && $oldNode instanceof Node) {\n      unmountSpecialComponent($oldNode);\n      $parent.removeChild($oldNode);\n      $oldNodes.splice(i, 1);\n      i--;\n      continue;\n    }\n\n    // Add new node if cached one doesn't exist\n    if (isNil($oldNode) && !isNil($newNode)) {\n      $parent.insertBefore($newNode, $anchor);\n      $oldNodes[i] = $newNode;\n      mountSpecialComponent($newNode);\n      continue;\n    }\n\n    // Update existing node\n    if (isNil($oldNode) || isNil($newNode)) {\n      // Only proceed if both nodes exist\n      continue;\n    }\n\n    // Handle text-to-text update\n    if ($oldNode instanceof Text && $newNode instanceof Text) {\n      $oldNode.textContent = $newNode.textContent;\n      continue;\n    }\n\n    // From here, we know cachedNode is an HTMLElement\n    if (!($oldNode instanceof HTMLElement)) {\n      continue;\n    }\n\n    // Case: HTMLElement → HTMLElement\n    if ($newNode instanceof HTMLElement) {\n      const isSame = $oldNode.isEqualNode($newNode);\n\n      if (!isSame) {\n        $oldNode.replaceWith($newNode);\n        $oldNodes[i] = $newNode;\n      }\n\n      continue;\n    }\n\n    // Case: HTMLElement → Text\n    if ($newNode instanceof Text) {\n      $oldNode.replaceWith($newNode);\n      $oldNodes[i] = $newNode;\n    }\n\n    // handleSpecialComponent(result);\n  }\n}\n","import { effect } from \"../state\";\nimport { getNode, normalizeDom } from \"../util\";\nimport { patch } from \"./patch\";\nimport { mountSpecialComponent } from \"./specialComponent\";\n\nexport function handleChildren(children: JSX.Element[]) {\n  const $fragment = document.createDocumentFragment();\n\n  for (const child of children) {\n    appendChild($fragment, child);\n  }\n\n  return $fragment;\n}\n\nfunction appendChild($parent: Node, child: JSX.Element) {\n  if (typeof child === \"function\") {\n    const anchor = document.createTextNode(\"\");\n    $parent.appendChild(anchor);\n\n    let $oldNodes: JSX.Element[] = [];\n\n    effect(() => {\n      const result = child();\n      const newNodes = normalizeDom(result);\n\n      const parentNode = anchor.parentNode;\n      if (!parentNode) return;\n\n      patch(parentNode, $oldNodes, newNodes, anchor);\n    });\n  } else if (Array.isArray(child)) {\n    // RECURSIVELY flatten nested arrays\n    child.forEach((nested) => appendChild($parent, nested));\n  } else {\n    const childRef = getNode(child) as Node;\n\n    $parent.appendChild(childRef);\n    mountSpecialComponent(childRef);\n  }\n}\n","export const UNIT_LESS_PROPS = [\n  \"animationIterationCount\",\n  \"borderImageOutset\",\n  \"borderImageSlice\",\n  \"borderImageWidth\",\n  \"boxFlex\",\n  \"boxFlexGroup\",\n  \"boxOrdinalGroup\",\n  \"columnCount\",\n  \"flex\",\n  \"flexGrow\",\n  \"flexPositive\",\n  \"flexShrink\",\n  \"flexNegative\",\n  \"flexOrder\",\n  \"gridRow\",\n  \"gridColumn\",\n  \"fontWeight\",\n  \"lineClamp\",\n  \"lineHeight\",\n  \"opacity\",\n  \"order\",\n  \"orphans\",\n  \"tabSize\",\n  \"widows\",\n  \"zIndex\",\n  \"zoom\",\n  \"fillOpacity\",\n  \"floodOpacity\",\n  \"stopOpacity\",\n  \"strokeDasharray\",\n  \"strokeDashoffset\",\n  \"strokeMiterlimit\",\n  \"strokeOpacity\",\n  \"strokeWidth\",\n];\n\nexport const IS_SSR = typeof document === \"undefined\";\n","import { effect } from \"../state\";\nimport { UNIT_LESS_PROPS } from \"../const\";\n\nexport function handleProps($element: HTMLElement, props: Record<string, any>) {\n  for (const key in props) {\n    if (key.startsWith(\"on\") && typeof props[key] === \"function\") {\n      const type = key.slice(2).toLowerCase();\n      let cleanup: () => void;\n\n      effect(() => {\n        // Remove the previous listener if there was one\n        if (cleanup) cleanup();\n\n        const fn = props[key]();\n        if (typeof fn === \"function\") {\n          $element.addEventListener(type, fn);\n          // Setup cleanup for next effect run\n          cleanup = () => $element.removeEventListener(type, fn);\n        }\n      });\n    } else {\n      effect(() => {\n        const value =\n          typeof props[key] === \"function\" ? props[key]() : props[key];\n\n        if (key === \"ref\" && typeof value === \"function\") {\n          value($element);\n        } else if (key === \"style\") {\n          applyStyle($element, value);\n        } else {\n          if (key === \"disabled\") $element.toggleAttribute(key, value);\n          else $element.setAttribute(key, value);\n        }\n      });\n    }\n  }\n}\n\nfunction applyStyle($element: HTMLElement, style: Record<string, any>) {\n  for (const [key, value] of Object.entries(style)) {\n    if (typeof value === \"number\" && !isUnitLessCSSProperty(key)) {\n      // @ts-ignore\n      $element.style[key] = `${value}px`;\n    } else {\n      // @ts-ignore\n      $element.style[key] = value;\n    }\n  }\n}\n\nfunction isUnitLessCSSProperty(prop: string): boolean {\n  const unitLessProps = new Set(UNIT_LESS_PROPS);\n\n  return unitLessProps.has(prop);\n}\n","import { handleChildren } from \"./handleChildren\";\nimport { handleProps } from \"./handleProps\";\n\nexport function createRoot($root: HTMLElement, app: JSX.Element) {\n  if (app instanceof HTMLElement) $root.appendChild(app);\n}\n\nexport let currentRenderingDOM: HTMLElement;\n\nexport function h(\n  type: string | Function,\n  props: Record<string, any>,\n  children: JSX.Element[]\n) {\n  if (typeof type === \"function\") {\n    return type({ ...props, children });\n  }\n\n  const $element = document.createElement(type);\n\n  handleProps($element, props);\n\n  $element.appendChild(handleChildren(children));\n\n  return $element;\n}\n\nexport function setCurrentRenderingDOM(dom: HTMLElement) {\n  currentRenderingDOM = dom;\n}\n\nexport function Fragment({ children }: { children: any[] }) {\n  const result: any[] = [];\n\n  const walk = (child: any) => {\n    if (typeof child === \"function\") {\n      child = child();\n    }\n\n    if (Array.isArray(child)) {\n      for (const c of child) walk(c);\n    } else {\n      result.push(child);\n    }\n  };\n\n  walk(children);\n  return children;\n}\n","export function hSSR(\n  type: string | Function,\n  props: Record<string, any>,\n  children: JSX.Element[]\n) {\n  if (typeof type === \"function\") {\n    return type({ ...props, children });\n  }\n\n  return `<${type} ${handlePropsSSR(props)}>${handleChildrenSSR(\n    children\n  )}</${type}>`;\n}\n\nfunction handlePropsSSR(props: Record<string, any>) {\n  // let template = \"\";\n  const transformedProps: string[] = [];\n\n  for (const key in props) {\n    if (key.startsWith(\"on\") && typeof props[key] === \"function\") {\n      continue;\n    }\n\n    const value = typeof props[key] === \"function\" ? props[key]() : props[key];\n\n    if (key === \"ref\" && typeof value === \"function\") {\n      // value($element);\n    } else if (key === \"style\") {\n      // applyStyle($element, value);\n    } else {\n      if (key === \"disabled\") value && transformedProps.push(\"disabled\");\n      else transformedProps.push(`${key}=\\\"${value}\\\"`);\n      // if (key === \"disabled\") $element.toggleAttribute(key, value);\n      // else $element.setAttribute(key, value);\n    }\n  }\n\n  return transformedProps.join(\" \");\n}\n\nfunction handleChildrenSSR(children: JSX.Element[]) {\n  let transformedChildren: string[] = [];\n\n  for (const child of children) {\n    if (typeof child === \"function\") {\n      transformedChildren.push(child());\n    } else if (Array.isArray(child)) {\n      // RECURSIVELY flatten nested arrays\n      child.forEach((nested) =>\n        transformedChildren.push(handleChildrenSSR([nested]))\n      );\n    } else {\n      // console.log(child);\n      transformedChildren.push(child as string);\n      // return child\n      // const childRef = getNode(child) as Node;\n\n      // $parent.appendChild(childRef);\n      // mountSpecialComponent(childRef);\n    }\n  }\n\n  return transformedChildren.join(\"\");\n}\n"],"names":["activeEffect","effect","fn","effectify","run","depMap","track","target","key","deps","dep","trigger","normalizeDom","children","isNil","value","getNode","node","mountSpecialComponent","_$node","$node","unmountSpecialComponent","patch","$parent","$oldNodes","$newNodes","$anchor","maxLength","i","$oldNode","$newNode","handleChildren","$fragment","child","appendChild","anchor","result","newNodes","parentNode","nested","childRef","UNIT_LESS_PROPS","IS_SSR","handleProps","$element","props","type","cleanup","applyStyle","style","isUnitLessCSSProperty","prop","createRoot","$root","app","h","setCurrentRenderingDOM","dom","Fragment","walk","c","hSSR","handlePropsSSR","handleChildrenSSR","transformedProps","transformedChildren"],"mappings":"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"}